import { expect } from "chai";
import axios from "axios";
import { getWeatherAnimation, getDays, commonString } from "./Utils/index";

describe("getWeatherAnimation function", () => {
    it("get the correct weather animation", () => {
        const expected = "sunny";
        const actual = getWeatherAnimation("clear sky");
        expect(actual).to.deep.equal(expected);
    })
    it("get the correct weather animation", () => {
        const expected = "windy";
        const actual = getWeatherAnimation("broken clouds");
        expect(actual).to.deep.equal(expected);
    })
})

describe("getDays function", () => {
    it("get the actual day of the week", () => {
        const expected = "Thu";
        const actual = getDays(1637226000000);
        expect(actual).to.deep.equal(expected);
    })
    it("get the actual day of the week", () => {
        const expected = "Fri";
        const actual = getDays(1637280000000);
        expect(actual).to.deep.equal(expected);
    })
})

describe("commonString function", () => {
    it("sort and filter out weather type based on 5 days forescast", () => {
        const expected = "clear sky";
        const actual = commonString(['clear sky', 'clear sky', 'clear sky', 'clear sky', 'scattered clouds', 'scattered clouds', 'broken clouds', 'overcast clouds']);
        expect(actual).to.deep.equal(expected);
    })
})

describe("fetch weather info when API call is successful", () => {
    it("return weather data metric unit", async () => {
        const expected = {"coord":{"lon":88.3697,"lat":22.5697},"weather":[{"id":721,"main":"Haze","description":"haze","icon":"50d"}],"base":"stations","main":{"temp":28.97,"feels_like":29.74,"temp_min":26.13,"temp_max":28.97,"pressure":1009,"humidity":51},"visibility":4000,"wind":{"speed":3.6,"deg":360},"clouds":{"all":90},"dt":1637232636,"sys":{"type":1,"id":9114,"country":"IN","sunrise":1637194876,"sunset":1637234540},"timezone":19800,"id":1275004,"name":"Kolkata","cod":200};
        const actual = await axios.get("https://api.openweathermap.org/data/2.5/weather?&q=Kolkata&APPID=faa3b9d358ff0e05601c8ec6ea446ef5&units=metric").then(results => {
            return results.data
        });
        expect(actual).to.deep.equal(expected);
    })
})

describe("fetch forecast info when API call is successful", () => {
    it("return forecast data metric unit", async () => {
        const expected = {"cod":"200","message":0,"cnt":40,"list":[{"dt":1637236800,"main":{"temp":28.97,"feels_like":29.74,"temp_min":23.99,"temp_max":28.97,"pressure":1009,"sea_level":1009,"grnd_level":1009,"humidity":51,"temp_kf":4.98},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":77},"wind":{"speed":2.64,"deg":338,"gust":3.28},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-18 12:00:00"},{"dt":1637247600,"main":{"temp":26.69,"feels_like":27.24,"temp_min":22.13,"temp_max":26.69,"pressure":1010,"sea_level":1010,"grnd_level":1010,"humidity":52,"temp_kf":4.56},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":65},"wind":{"speed":1.99,"deg":334,"gust":2.23},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-18 15:00:00"},{"dt":1637258400,"main":{"temp":23.56,"feels_like":23.36,"temp_min":20.86,"temp_max":23.56,"pressure":1010,"sea_level":1010,"grnd_level":1010,"humidity":53,"temp_kf":2.7},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":42},"wind":{"speed":1.75,"deg":348,"gust":1.79},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-18 18:00:00"},{"dt":1637269200,"main":{"temp":19.51,"feels_like":19,"temp_min":19.51,"temp_max":19.51,"pressure":1010,"sea_level":1010,"grnd_level":1009,"humidity":57,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":10},"wind":{"speed":1.97,"deg":6,"gust":2.09},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-18 21:00:00"},{"dt":1637280000,"main":{"temp":18.45,"feels_like":17.94,"temp_min":18.45,"temp_max":18.45,"pressure":1010,"sea_level":1010,"grnd_level":1009,"humidity":61,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":6},"wind":{"speed":2.57,"deg":359,"gust":2.9},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-19 00:00:00"},{"dt":1637290800,"main":{"temp":23.96,"feels_like":23.74,"temp_min":23.96,"temp_max":23.96,"pressure":1012,"sea_level":1012,"grnd_level":1011,"humidity":51,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":1},"wind":{"speed":2.26,"deg":24,"gust":2.8},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-11-19 03:00:00"},{"dt":1637301600,"main":{"temp":28.33,"feels_like":27.75,"temp_min":28.33,"temp_max":28.33,"pressure":1010,"sea_level":1010,"grnd_level":1009,"humidity":37,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":3},"wind":{"speed":2.92,"deg":355,"gust":2.88},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-11-19 06:00:00"},{"dt":1637312400,"main":{"temp":29.24,"feels_like":28.34,"temp_min":29.24,"temp_max":29.24,"pressure":1007,"sea_level":1007,"grnd_level":1006,"humidity":34,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":41},"wind":{"speed":2.64,"deg":342,"gust":2.53},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-11-19 09:00:00"},{"dt":1637323200,"main":{"temp":24.7,"feels_like":24.4,"temp_min":24.7,"temp_max":24.7,"pressure":1008,"sea_level":1008,"grnd_level":1007,"humidity":45,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":46},"wind":{"speed":2.35,"deg":343,"gust":2.85},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-19 12:00:00"},{"dt":1637334000,"main":{"temp":22.96,"feels_like":22.59,"temp_min":22.96,"temp_max":22.96,"pressure":1010,"sea_level":1010,"grnd_level":1009,"humidity":49,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":83},"wind":{"speed":1.9,"deg":345,"gust":2.13},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-19 15:00:00"},{"dt":1637344800,"main":{"temp":21.94,"feels_like":21.52,"temp_min":21.94,"temp_max":21.94,"pressure":1009,"sea_level":1009,"grnd_level":1008,"humidity":51,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":91},"wind":{"speed":1.31,"deg":2,"gust":1.38},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-19 18:00:00"},{"dt":1637355600,"main":{"temp":20.61,"feels_like":20.14,"temp_min":20.61,"temp_max":20.61,"pressure":1009,"sea_level":1009,"grnd_level":1008,"humidity":54,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":68},"wind":{"speed":1.67,"deg":13,"gust":1.71},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-19 21:00:00"},{"dt":1637366400,"main":{"temp":19.43,"feels_like":18.92,"temp_min":19.43,"temp_max":19.43,"pressure":1009,"sea_level":1009,"grnd_level":1008,"humidity":57,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":38},"wind":{"speed":2.06,"deg":3,"gust":2.36},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-20 00:00:00"},{"dt":1637377200,"main":{"temp":24.51,"feels_like":24.22,"temp_min":24.51,"temp_max":24.51,"pressure":1012,"sea_level":1012,"grnd_level":1011,"humidity":46,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":6},"wind":{"speed":1.92,"deg":20,"gust":2.12},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-11-20 03:00:00"},{"dt":1637388000,"main":{"temp":29.01,"feels_like":28.21,"temp_min":29.01,"temp_max":29.01,"pressure":1010,"sea_level":1010,"grnd_level":1009,"humidity":35,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":8},"wind":{"speed":2.68,"deg":356,"gust":2.7},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-11-20 06:00:00"},{"dt":1637398800,"main":{"temp":30,"feels_like":28.91,"temp_min":30,"temp_max":30,"pressure":1008,"sea_level":1008,"grnd_level":1007,"humidity":32,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":28},"wind":{"speed":2.63,"deg":341,"gust":2.53},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-11-20 09:00:00"},{"dt":1637409600,"main":{"temp":25.78,"feels_like":25.56,"temp_min":25.78,"temp_max":25.78,"pressure":1008,"sea_level":1008,"grnd_level":1007,"humidity":44,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":32},"wind":{"speed":2.23,"deg":1,"gust":2.71},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-20 12:00:00"},{"dt":1637420400,"main":{"temp":24.48,"feels_like":24.26,"temp_min":24.48,"temp_max":24.48,"pressure":1010,"sea_level":1010,"grnd_level":1009,"humidity":49,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":78},"wind":{"speed":1.62,"deg":351,"gust":1.84},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-20 15:00:00"},{"dt":1637431200,"main":{"temp":23.1,"feels_like":22.85,"temp_min":23.1,"temp_max":23.1,"pressure":1010,"sea_level":1010,"grnd_level":1009,"humidity":53,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":54},"wind":{"speed":1.12,"deg":359,"gust":1.19},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-20 18:00:00"},{"dt":1637442000,"main":{"temp":22.77,"feels_like":22.49,"temp_min":22.77,"temp_max":22.77,"pressure":1009,"sea_level":1009,"grnd_level":1008,"humidity":53,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":78},"wind":{"speed":1.87,"deg":357,"gust":2.1},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-20 21:00:00"},{"dt":1637452800,"main":{"temp":22.59,"feels_like":22.26,"temp_min":22.59,"temp_max":22.59,"pressure":1010,"sea_level":1010,"grnd_level":1009,"humidity":52,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":88},"wind":{"speed":2.18,"deg":350,"gust":2.55},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-21 00:00:00"},{"dt":1637463600,"main":{"temp":23.51,"feels_like":23.25,"temp_min":23.51,"temp_max":23.51,"pressure":1012,"sea_level":1012,"grnd_level":1011,"humidity":51,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":98},"wind":{"speed":1.46,"deg":2,"gust":1.67},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-11-21 03:00:00"},{"dt":1637474400,"main":{"temp":28.47,"feels_like":27.87,"temp_min":28.47,"temp_max":28.47,"pressure":1011,"sea_level":1011,"grnd_level":1010,"humidity":37,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":86},"wind":{"speed":2.51,"deg":343,"gust":3.01},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-11-21 06:00:00"},{"dt":1637485200,"main":{"temp":29.25,"feels_like":28.51,"temp_min":29.25,"temp_max":29.25,"pressure":1009,"sea_level":1009,"grnd_level":1008,"humidity":36,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":50},"wind":{"speed":3.04,"deg":339,"gust":3.17},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-11-21 09:00:00"},{"dt":1637496000,"main":{"temp":25.08,"feels_like":24.92,"temp_min":25.08,"temp_max":25.08,"pressure":1010,"sea_level":1010,"grnd_level":1009,"humidity":49,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":39},"wind":{"speed":2.69,"deg":347,"gust":3.26},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-21 12:00:00"},{"dt":1637506800,"main":{"temp":23.87,"feels_like":23.67,"temp_min":23.87,"temp_max":23.87,"pressure":1011,"sea_level":1011,"grnd_level":1010,"humidity":52,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":9},"wind":{"speed":1.34,"deg":347,"gust":1.56},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-21 15:00:00"},{"dt":1637517600,"main":{"temp":23.22,"feels_like":22.93,"temp_min":23.22,"temp_max":23.22,"pressure":1011,"sea_level":1011,"grnd_level":1010,"humidity":51,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":9},"wind":{"speed":1.58,"deg":323,"gust":1.73},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-21 18:00:00"},{"dt":1637528400,"main":{"temp":22.1,"feels_like":21.78,"temp_min":22.1,"temp_max":22.1,"pressure":1010,"sea_level":1010,"grnd_level":1009,"humidity":54,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":7},"wind":{"speed":2.03,"deg":353,"gust":2.33},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-21 21:00:00"},{"dt":1637539200,"main":{"temp":21.55,"feels_like":21.25,"temp_min":21.55,"temp_max":21.55,"pressure":1011,"sea_level":1011,"grnd_level":1010,"humidity":57,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":8},"wind":{"speed":1.23,"deg":349,"gust":1.31},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-22 00:00:00"},{"dt":1637550000,"main":{"temp":26.25,"feels_like":26.25,"temp_min":26.25,"temp_max":26.25,"pressure":1013,"sea_level":1013,"grnd_level":1012,"humidity":45,"temp_kf":0},"weather":[{"id":801,"main":"Clouds","description":"few clouds","icon":"02d"}],"clouds":{"all":16},"wind":{"speed":1.92,"deg":334,"gust":2},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-11-22 03:00:00"},{"dt":1637560800,"main":{"temp":30.27,"feels_like":29.66,"temp_min":30.27,"temp_max":30.27,"pressure":1011,"sea_level":1011,"grnd_level":1010,"humidity":37,"temp_kf":0},"weather":[{"id":801,"main":"Clouds","description":"few clouds","icon":"02d"}],"clouds":{"all":11},"wind":{"speed":3.15,"deg":346,"gust":3.43},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-11-22 06:00:00"},{"dt":1637571600,"main":{"temp":30.65,"feels_like":30.34,"temp_min":30.65,"temp_max":30.65,"pressure":1008,"sea_level":1008,"grnd_level":1007,"humidity":39,"temp_kf":0},"weather":[{"id":801,"main":"Clouds","description":"few clouds","icon":"02d"}],"clouds":{"all":20},"wind":{"speed":2.97,"deg":345,"gust":3.01},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-11-22 09:00:00"},{"dt":1637582400,"main":{"temp":27.05,"feels_like":27.53,"temp_min":27.05,"temp_max":27.05,"pressure":1009,"sea_level":1009,"grnd_level":1008,"humidity":51,"temp_kf":0},"weather":[{"id":801,"main":"Clouds","description":"few clouds","icon":"02n"}],"clouds":{"all":20},"wind":{"speed":2.28,"deg":348,"gust":2.66},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-22 12:00:00"},{"dt":1637593200,"main":{"temp":25.91,"feels_like":25.97,"temp_min":25.91,"temp_max":25.91,"pressure":1011,"sea_level":1011,"grnd_level":1009,"humidity":54,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":2},"wind":{"speed":1.13,"deg":1,"gust":1.14},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-22 15:00:00"},{"dt":1637604000,"main":{"temp":24.8,"feels_like":24.85,"temp_min":24.8,"temp_max":24.8,"pressure":1010,"sea_level":1010,"grnd_level":1009,"humidity":58,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":1},"wind":{"speed":0.59,"deg":108,"gust":0.74},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-22 18:00:00"},{"dt":1637614800,"main":{"temp":23.43,"feels_like":23.47,"temp_min":23.43,"temp_max":23.43,"pressure":1010,"sea_level":1010,"grnd_level":1009,"humidity":63,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":2.03,"deg":3,"gust":2.34},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-22 21:00:00"},{"dt":1637625600,"main":{"temp":22.13,"feels_like":22.15,"temp_min":22.13,"temp_max":22.13,"pressure":1011,"sea_level":1011,"grnd_level":1010,"humidity":67,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":2.42,"deg":20,"gust":2.77},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2021-11-23 00:00:00"},{"dt":1637636400,"main":{"temp":26.36,"feels_like":26.36,"temp_min":26.36,"temp_max":26.36,"pressure":1013,"sea_level":1013,"grnd_level":1012,"humidity":52,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":0},"wind":{"speed":2.42,"deg":39,"gust":2.7},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-11-23 03:00:00"},{"dt":1637647200,"main":{"temp":30.1,"feels_like":30.05,"temp_min":30.1,"temp_max":30.1,"pressure":1012,"sea_level":1012,"grnd_level":1011,"humidity":42,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":0},"wind":{"speed":2.29,"deg":17,"gust":2.34},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-11-23 06:00:00"},{"dt":1637658000,"main":{"temp":31.03,"feels_like":30.67,"temp_min":31.03,"temp_max":31.03,"pressure":1009,"sea_level":1009,"grnd_level":1008,"humidity":38,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":3},"wind":{"speed":2.95,"deg":352,"gust":3.04},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2021-11-23 09:00:00"}],"city":{"id":1275004,"name":"Kolkata","coord":{"lat":22.5697,"lon":88.3697},"country":"IN","population":4631392,"timezone":19800,"sunrise":1637194876,"sunset":1637234540}};
        const actual = await axios.get("https://api.openweathermap.org/data/2.5/forecast?&q=Kolkata&APPID=faa3b9d358ff0e05601c8ec6ea446ef5&units=metric").then(results => {
            return results.data
        });
        expect(actual).to.deep.equal(expected);
    })
})